### 상품 주문시 service 메서드에 @Transactional 어노테이션을 붙이지 않아 디비에 주문 내역이 저장되지 않았다

- 엔티티 매니저를 사용하는 경우 메서드 실행이 완료된후 실제 데이터가 디비에 반영된다
- @Transactonal에 의해 커밋하는 순간 영속성 컨텍스트에 새로 저장된 엔티티를 데이터베이스에 반영한다
- commit 될때 JPA가 엔티티의 변경을 감지하게 된다
- 변경이 발생하지 않은 경우 save 메서드를 호출하여 insert 쿼리를 실행시킨다
- 변경이 발생한 경우 merge 메서드를 호출하여 update 쿼리를 실행시킨다
- merge의 경우 엔티티의 부분만을 변경할 수 없다
- 따라서 수정을 하는 경우
- db에서 엔티티를 한번 조회해 온다
- 그러면 엔티티가 반영속 상태가 된다
- 이 상태에서 엔티티의 데이터를 수정한다
- 엔티티의 id는 변하지 않기 때문에 JPA가 id를 사용하여 변경을 감지하여 해당 row의 변경된 부분만 update 쿼리를 실행해 준다