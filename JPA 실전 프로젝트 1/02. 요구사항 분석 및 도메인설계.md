### 기능 목록

- 회원 기능
    - 회원 등록
    - 회원 조회
- 상품 기능
    - 상품 등록
    - 상품 수정
    - 상품 조회
- 주문 기능
    - 상품 주문
    - 주문 내역 조회
    - 주문 취소
- 기타 요구사항
    - 상품은 재고 관리가 필요하다
    - 상품의 종류는 도서 , 음반 , 영화가 있다
    - 상품을 카테고리로 구분할 수 있다
    - 상품 주문시 배송 정보를 입력할 수 있다
    

### 도메인 모델과 테이블 설계

![jpa_shop_도메인모델과 테이블 설계](https://user-images.githubusercontent.com/42866800/164467157-884a4d10-07c1-41d5-bd40-96ffec62916d.png)


- 회원은 여러개의 주문을 할 수 있다 (1 : N)
    - 회원이 주문을 하는 것 처럼 보이지만 주문이 회원정보를 갖고 있으면 된다
    - 그래서 1 : N 관계를 만들지 않아도 되지만 1 : N 예시를 위해 만들었다
- 여러개의 주문에는 여러개의 상품이 있을수 있다 (N : M)
    - 다 : 다 관계의 경우 1 : N  과 N : 1 관계로 풀어줘야 한다
    - 따라서 주문상품이라는 엔티티를 둔다
    - 하나의 주문에는 여러개의 주문상품이 담길 수 있다 (1 : N)
    - 하나의 상품이 여러개의 주문상품에 담길수 있다 (1 : N)
- 상품의 종류에는 도서 , 음반 , 영화 가 있는데 상품을 상속받는다
- 하나의 주문에는 하나의 배송 정보가 담긴다 (1 : 1)
- 여러개의 상품은 여러개의 카테고리에 속할 수 있다 (N: M)
    - 실무에서 다 : 다 관계를 사용하는 것은 좋지 않다

### 회원 엔티티 분석

![jpa_shop_엔티티 설계](https://user-images.githubusercontent.com/42866800/164467160-4a84119d-ca4a-4f89-87bb-032527db17be.png)


- Member 엔티티는 Address를 갖는다
- Address는 Enmbeded 타입 값 타입이다
- 회원이 여러개의 주문을 갖는다는 가정하에 , Member가 orders를 List로 갖는다

- Order와 Item은 N : M 관계이다
- N : M 관계를 해체하기 위해 OrderItem 엔티티를 뒀다
- 여러개의 주문 상품이 하나의 주문에 담긴다
- 따라서 Order를 Fk로 갖고있는 쪽이 연관관계의 주인이 된다
- 하나의 상품이 여러개의 주문에 담길수 있다
- 따라서 Item을 Fk로 갖고있는 쪽이 연관관계의 주인이 된다

- 여러개의 아이템이 여러개의 카테고리에 속할 수 있다
- N : M 관계이다

- 하나의 주문은 하나의 배송정보를 갖는다
- 1 : 1 관계이다
- 배송 엔티티의 경우 Address를 임베디드 타입으로 갖는다

### 테이블 분석

![jpa_shop_테이블 설계도.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f62a00cf-7bba-4ce0-9deb-36ed7668c628/jpa_shop_테이블_설계도.png)

- 하나의 회원이 여러개의 주문을 가지므로 Orders 테이블이 Member를 FK로 갖는다

- 하나의 주문은 여러개의 주문상품을 가지므로 Order_item 테이블이 Order를 FK로 갖는다
- FK Order가 연관관계의 주인이 된다

- 하나의 아이템은 여러개의 주문상품에 담길수 있다
- 따라서 Order_item 테이블이 Item을 FK로 갖는다
- FK Item이 연관관계의 주인이 된다

- 여러개의 아이템이 여러 카테고리에 속할 수 있다
- 디비에서는 N : M 관계를 표현할수 없다
- 따라서 이를 해체해주기 위해 category_item 테이블을 뒀다
- 하나의 아이템은 여러개의 category아이템에 속할 수 있다
- category_item 테이블이 item 을 FK로 갖는다
- 하나의 카테고리에는 여러개의 카테고리아이템이 있을 수 있다
- 따라서 category_item 테이블이 category를 fk로 갖는다
- category fk가 연관관계의 주인이 된다