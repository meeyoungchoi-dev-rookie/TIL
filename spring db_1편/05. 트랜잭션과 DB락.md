## íŠ¸ëœì­ì…˜ ê°œë…

- í•˜ë‚˜ì˜ ê±°ë˜ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ë„ë¡ ë³´ì¥í•´ì£¼ëŠ” ê²ƒ
- ì—¬ëŸ¬ ì‘ì—…ì„ ì§„í–‰í•˜ë‹¤ê°€ ë¬¸ì œê°€ ìƒê²¼ã„·ì„ ê²½ìš° ì´ì „ ìƒíƒœë¡œ ë¡¤ë°±í•˜ê¸° ìœ„í•´ ì‚¬ìš©
- í•œë²ˆ ì§ˆì˜ê°€ ì‹¤í–‰ë˜ë©´ ì§ˆì˜ê°€ ëª¨ë‘ ìˆ˜í–‰ë˜ê±°ë‚˜ ëª¨ë‘ ìˆ˜í–‰ë˜ì§€ ì•ŠëŠ” ì‘ì—…ìˆ˜í–‰ì˜ ë…¼ë¦¬ì  ë‹¨ìœ„
- íŠ¸ëœì­ì…˜ ì»¤ë°‹ - ì‘ì—…ì´ ë§ˆë¬´ë¦¬ ë¨
- íŠ¸ëœì­ì…˜ ë¡¤ë°± - ì‘ì—…ì„ ì·¨ì†Œí•˜ê³  ì´ì „ ìƒíƒœë¡œ ëŒë¦¼

## íŠ¸ëœì­ì…˜ ACID

- ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì—ì„œ ì¼ì–´ë‚˜ëŠ” í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì˜ ì•ˆì „ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì„±ì§ˆ
- ì›ìì„±, ì¼ê´€ì„±, ê²©ë¦¬ì„±, ì§€ì†ì„±ì„ ë³´ì¥í•´ ì£¼ëŠ” ê²ƒ
- ì›ìì„± - íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰í•œ ì‘ì—…ì€ ë§ˆì¹˜ í•˜ë‚˜ì˜ ì‘ì—…ì¸ ê²ƒì²˜ëŸ¼ ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼ í•œë‹¤
    - íŠ¸ëœì­ì…˜ì˜ ì‘ì—…ì´ ë¶€ë¶„ì ìœ¼ë¡œ ì‹¤í–‰ë˜ê±°ë‚˜ ì¤‘ë‹¨ë˜ì§€ ì•ŠëŠ” ê²ƒì„ ë³´ì¥
- ì¼ê´€ì„± - íŠ¸ëœì­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ì¼ê´€ì ì¸ DB ìƒíƒœë¥¼ ìœ ì§€í•œë‹¤
- ê²©ë¦¬ì„± - ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” íŠ¸ëœì­ì…˜ì´ ì„œë¡œ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šë„ë¡ ê²©ë¦¬í•´ì•¼ í•œë‹¤
    - ë™ì‹œì— ê°™ì€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ì§€ ëª»í•˜ë„ë¡ í•œë‹¤
    - ê²©ë¦¬ì„±ì€ ë™ì‹œì„±ê³¼ ê´€ë ¨ìˆì–´ ì„±ëŠ¥ì´ìŠˆ ê´€ë ¨í•˜ì—¬ ê²©ë¦¬ìˆ˜ì¤€ì„ ì„ íƒí•´ì•¼ í•œë‹¤
- ì§€ì†ì„± - íŠ¸ëœì­ì…˜ì„ ì„±ê³µì ìœ¼ë¡œ ëë‚´ë©´ ê·¸ ê²°ê³¼ê°€ í•­ìƒ ê¸°ë¡ë˜ì–´ì•¼ í•œë‹¤
    - ì¤‘ê°„ì— ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ë°œìƒí•´ë„ ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„±ê³µí•œ íŠ¸ëœì­ì…˜ ë‚´ìš©ì„ ë³µêµ¬ í•´ì•¼ í•œë‹¤
    - 

## íŠ¸ëœì­ì…˜ê³¼ ê²©ë¦¬ ìˆ˜ì¤€

- íŠ¸ëœì­ì…˜ì˜ ì›ìì„±, ì¼ê´€ì„± , ì§€ì†ì„±ì„ ë³´ì¥í•œë‹¤
- ê²©ë¦¬ì„±ì„ ë³´ì¥í•˜ë ¤ë©´ íŠ¸ëœì­ì…˜ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•´ì•¼ í•œë‹¤
- íŠ¸ëœì­ì…˜ì˜ ë™ì‹œ ì²˜ë¦¬ ì„±ëŠ¥ì´ ë§¤ìš° ë‚˜ë¹ ì§€ëŠ” ë‹¨ì ì´ ìˆë‹¤

## ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° êµ¬ì¡°ì™€ ì„¸ì…˜

![ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ëŠ” ê³¼ì •ê³¼ ì„¸ì…˜](https://user-images.githubusercontent.com/42866800/166472759-3c14f541-15fe-44ae-ad33-9ce162898e3e.png)

1. ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë‚˜ DB ì ‘ê·¼ íˆ´ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì— ì ‘ê·¼í•œë‹¤
2. í´ë¼ì´ì–¸íŠ¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ì— ì—°ê²°ì„ ìš”ì²­í•˜ê³  ì»¤ë„¥ì…˜ì„ ë§ºê²Œ ëœë‹¤
3. ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ëŠ” ë‚´ë¶€ì— ì„¸ì…˜ì´ ìˆëŠ”ë° ì»¤ë„¥ì…˜ì„ í†µí•´ ë“¤ì–´ì˜¨ ìš”ì²­ì€ ì„¸ì…˜ì„ í†µí•´ ì‹¤í–‰ë˜ê²Œ ëœë‹¤
    1. ê°œë°œìê°€ í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ SQLì„ ì „ë‹¬í•˜ë©´ í˜„ì¬ ì»¤ë„¥ì…˜ì— ì—°ê²°ëœ ì„¸ì…˜ì´ SQLì„ ì‹¤í–‰í•œë‹¤
    2. ì„¸ì…˜ì€ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ì»¤ë°‹ ë˜ëŠ” ë¡¤ë°±ì„ í†µí•´ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•œë‹¤
    3. ì‚¬ìš©ìê°€ ì»¤ë„¥ì…˜ì„ ë‹«ê±°ë‚˜ DBAê°€ ì„¸ì…˜ì„ ê°•ì œë¡œ ì¢…ë£Œí•˜ë©´ ì„¸ì…˜ì€ ì¢…ë£Œëœë‹¤

![ì»¤ë„¥ì…˜ í’€ì—ì„œ 10ê°œì˜ ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ë©´ ì„¸ì…˜ë„ 10ê°œ ë§Œë“¤ì–´ ì§„ë‹¤](https://user-images.githubusercontent.com/42866800/166473010-24553f60-348f-45a4-8894-32c657bb06a5.png)

- ì»¤ë„¥ì…˜ í’€ì— 10ê°œì˜ ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ë©´ ì„¸ì…˜ë„ 10ê°œê°€ ë§Œë“¤ì–´ ì§„ë‹¤

## ìë™ ì»¤ë°‹ , ìˆ˜ë™ ì»¤ë°‹

- ìë™ ì»¤ë°‹
    
    ```sql
    set autocommit true; 
    ```
    
    - ê° ì¿¼ë¦¬ ì‹¤í–‰ ì§í›„ ìë™ìœ¼ë¡œ ì»¤ë°‹ì„ í˜¸ì¶œí•œë‹¤
    - ì»¤ë°‹ì´ë‚˜ ë¡¤ë°±ì„ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” í¸ë¦¬í•¨ì´ ìˆë‹¤
    - ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ì»¤ë°‹ì´ ë˜ë²„ë¦¬ê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ì„ ì œëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤
    - ì¿¼ë¦¬ ì‹¤í–‰ì‹œ defaultê°€ autocommit trueì´ë‹¤
    
- ìˆ˜ë™ ì»¤ë°‹
    
    ```sql
    set autocommit false;
    ```
    
    - ìˆ˜ë™ ì»¤ë°‹ìœ¼ë¡œ ì„¤ì •í•´ ë†“ëŠ”ê²ƒì„ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤ê³  í‘œí˜„í•œë‹¤
    - ìˆ˜ë™ ì»¤ë°‹ì„ ì„¤ì •í•œí›„ commit ë˜ëŠ” rollbackì„ í˜¸ì¶œí•´ ì¤˜ì•¼ í•œë‹¤
    - ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë‚˜ ìë™ ì»¤ë°‹ ëª¨ë“œëŠ” í•œë²ˆ ì„¤ì •í•˜ë©´ í•´ë‹¹ ì„¸ì…˜ì—ì„œ ê³„ì† ìœ ì§€ëœë‹¤
    - ì¤‘ê°„ì— ë³€ê²½ ê°€ëŠ¥í•˜ë‹¤

## ì»¤ë°‹ê³¼ ë¡¤ë°±

### íŠ¸ëœì­ì…˜ DB ì˜ˆì œ - ê³„ì¢Œì´ì²´

```java
drop table member if exists;
create table member (
      member_id varchar(10),
     money integer not null default 0,
     primary key (member_id)
);

set autocommit true;
insert into member(member_id, money) values('data1', 10000);
insert into member(member_id, money) values('data2', 10000);

select * from member;

// íŠ¸ëœì­ì…˜ ì‹œì‘
set autocommit false; // ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ

insert into member(member_id, money) values('newId1', 10000);
insert into member(member_id, money) values('newId2', 10000);

// ì»¤ë°‹ ì „ì´ë¯€ë¡œ ì„¸ì…˜1ì—ì„œë§Œ ë””ë¹„ì— insertëœ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤
select * from member;

// ì„¸ì…˜1ì—ì„œ ì»¤ë°‹ ì§„í–‰
commit;
select * from member;

// ë¡¤ë°± : ë°ì´í„°ë² ì´ìŠ¤ì— ë³€ê²½ì‚¬í•­ì„ ë°˜ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤
// ë°ì´í„° ì´ˆê¸°í™”
set autocommit true;
delete from member;
insert into member(member_id, money) values('oldId', 10000);

// íŠ¸ëœì­ì…˜ ì‹œì‘
set autocommit false; // ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ

insert into member(member_id, money) values('newId1', 10000);
insert into member(member_id, money) values('newId2', 10000);

select * from member;

// ì„¸ì…˜1ì´ ë¡¤ë°±ì„ í•˜ëŠ” ê²½ìš°
rollback;
// ë°ì´í„°ê°€ ë“±ë¡ë˜ê¸° ì „ ìƒíƒœë¡œ ëŒì•„ê°„ë‹¤
select * from member;
```

```java
select * from member;

// ì„¸ì…˜1ì´ ì•„ì§ ì»¤ë°‹ì„ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì„ì‹œë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ì—†ë‹¤
select * from member;

//  ì„¸ì…˜1ì´ ì»¤ë°‹ì„ í•œ í›„ì— ì„¸ì…˜2ê°€ ì¡°íšŒ í•˜ëŠ” ê²½ìš°
select * from member;
```

- ê³„ì¢Œì´ì²´ ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆëŠ”ë° ì»¤ë°‹ì„ í•´ë²„ë¦¬ëŠ” ê²½ìš°


![íŠ¸ëœì­ì…˜ ì§„í–‰ì¤‘ ì¿¼ë¦¬ì— ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ë° ìë™ìœ¼ë¡œ ì»¤ë°‹ì´ ë˜ì–´ë²„ë¦¬ëŠ” ê²½ìš° ë°œìƒí•˜ëŠ” ë¬¸ì œ](https://user-images.githubusercontent.com/42866800/166473130-a2ca6165-8243-4896-b894-6bd0caea84bf.png)
ng)

- memberAê°€ memberBì—ê²Œ 2ì²œì›ì„ ì´ì²´í•œë‹¤ê³  ê°€ì •
- ì„¸ì…˜1ì—ì„œ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ì—ˆë‹¤
- memberAì˜ ëˆì—ì„œ 2ì²œì›ì´ ì°¨ê°ë˜ëŠ” ì¿¼ë¦¬ëŠ” ì˜ ìˆ˜í–‰ì´ ë˜ì—ˆë‹¤
- ê·¸ëŸ°ë° memberBì— 2ì²œì›ì´ ì¦ê°€ë˜ëŠ” ì¿¼ë¦¬ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬ ì œëŒ€ë¡œ ìˆ˜í–‰ë˜ì§€ ëª»í–ˆë‹¤
- ê·¸ëŸ°ë° ì„¸ì…˜1 íŠ¸ëœì­ì…˜ì—ì„œ ê°•ì œ ì»¤ë°‹ì„ ì‹œì¼°ë‹¤
- ì„¸ì…˜2ê°€ í…Œì´ë¸”ì„ ì¡°íšŒí–ˆì„ë•Œ memberAì˜ ê¸ˆì•¡ì€ 2ì²œì›ì´ ì°¨ê°ë˜ì—ˆì§€ë§Œ
- memberBì˜ ê¸ˆì•¡ì€ 2ì²œì›ì´ ì¦ê°€ë˜ì§€ ì•Šì€ ê²°ê³¼ë¥¼ ë³´ê²Œ ëœë‹¤
- ì›í•˜ëŠ”ë°ë¡œ íŠ¸ëœì­ì…˜ì´ ì´ë¤„ì§€ì§€ ëª»í–ˆë‹¤

```java

// ê³„ì¢Œì´ì²´ ë„ì¤‘ì— ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ë° ìë™ì»¤ë°‹ìœ¼ë¡œ ì„¤ì •ë˜ ìˆëŠ” ê²½ìš°

set autocommit true;

delete from member;

insert into member(member_id, money) values('memberA', 10000);
insert into member(member_id, money) values('memberB', 10000);

select * from member;

set autocommit false; // íŠ¸ëœì­ì…˜ ì‹œì‘

update member set money = 10000 - 2000 where member_id = 'memberA';
update member set money = 10000 + 2000 where member_iddd = 'memberB'; // ì¿¼ë¦¬ ì˜ˆì™¸ ë°œìƒ

select * from member;
// memberAì˜ ëˆì€ 2ì²œì› ì¤„ì—ˆì§€ë§Œ memberBì˜ ëˆì€ 2ì²œì› ì¦ê°€ë˜ì§€ ì•Šì•˜ë‹¤

// ì»¤ë°‹ì„ í•˜ëŠ” ê²½ìš°
// ì„¸ì…˜2ì—ì„œë„ memberBì˜ ëˆì´ 2ì²œì› ì¦ê°€ë˜ì§€ ì•Šì€ ê°’ìœ¼ë¡œ ë³´ì¼ê²ƒì´ë‹¤
commit;
// memberAì˜ ëˆë§Œ 2ì²œì› ì¤„ì–´ë“œëŠ” ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•˜ê²Œ ëœë‹¤

```

- ê³„ì¢Œì´ì²´ ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒí•˜ì—¬ rollbackìœ¼ë¡œ ë°ì´í„°ë¥¼ ë˜ëŒë¦¬ëŠ” ê²½ìš°
- ì¤‘ê°„ì— ì¿¼ë¦¬ì— ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ê²½ìš° ì»¤ë°‹ì„ í˜¸ì¶œí•˜ë©´ ì•ˆëœë‹¤
- ë¡¤ë°±ì„ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ìœ¼ë¡œ ì›ë³µì‹œì¼œì•¼ í•œë‹¤

![ë¡¤ë°±í•˜ì—¬ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ê¸° ì´ì „ìƒíƒœë¡œ ë°ì´í„° ì›ë³µì‹œí‚¨ë‹¤](https://user-images.githubusercontent.com/42866800/166473323-ac9d82c1-ac05-4519-949c-a98e19325991.png)

```java
// ê³„ì¢Œì´ì²´ ë„ì¤‘ ë¬¸ì œê°€ ë°œìƒí•˜ì—¬ rollbackìœ¼ë¡œ ë°ì´í„°ë¥¼ ë˜ëŒë¦¬ëŠ” ê²½ìš°

set autocommit true;

delete from member;

insert into member(member_id, money) values('memberA', 10000);
insert into member(member_id, money) values('memberB', 10000);

select * from member;

set autocommit false; // íŠ¸ëœì­ì…˜ ì‹œì‘

update member set money = 10000 - 2000 where member_id = 'memberA';
update member set money = 10000 + 2000 where member_iddd = 'memberB'; // ì¿¼ë¦¬ ì˜ˆì™¸ ë°œìƒ

select * from member;

// rollbackì„ í•˜ì—¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê¸° ì´ì „ ìƒíƒœë¡œ ë˜ëŒë¦°ë‹¤
// íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê¸° ì „ë‹¨ê³„ë¡œ ë°ì´í„°ë¥¼ ë³µêµ¬í•œë‹¤
rollback;

select * from member;
```

## DB ë½

- ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•œ ë°©ë²•
- íŠ¹ì • ë°ì´í„°ì— ëŒ€í•´ ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì´ ë¬´ë¶„ë³„í•˜ê²Œ ë™ì‹œì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë§‰ëŠ” ì¥ì¹˜

- ì„¸ì…˜1ì´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë™ì•ˆ ì»¤ë°‹ì„ í•˜ì§€ ì•Šì•˜ëŠ”ë°
- ì„¸ì…˜2ì—ì„œ ë™ì‹œì— ê°™ì€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê²Œ ë˜ë©´ ì—¬ëŸ¬ê°€ì§€ ë¬¸ì œê°€ ë°œìƒí•œë‹¤
- íŠ¸ëœì­ì…˜ì˜ ì›ìì„±ì´ ê¹¨ì§„ë‹¤
- ë˜í•œ ì„¸ì…˜1ì´ ì¤‘ê°„ì— ë¡¤ë°±ì„ í•˜ê²Œ ë˜ë©´ ì„¸ì…˜2ëŠ” ì˜ëª»ëœ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë¬¸ì œê°€ ìƒê¸´ë‹¤

```sql
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
```

### í•´ê²°ì±…

- ì„¸ì…˜ì´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë™ì•ˆ ì»¤ë°‹ì´ë‚˜ ë¡¤ë°±ì „ê¹Œì§€ ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ í•´ë‹¹ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ì—†ê²Œ ë§‰ì•„ì•¼ í•œë‹¤

- 1.

```sql
set autocommit false;
update member set money=500 where member_id = 'memberA';
```

- ì„¸ì…˜1ê³¼ ì„¸ì…˜2ê°€ ë™ì‹œì— ë™ì¼í•œ rowì˜ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë ¤ê³  í•œë‹¤

![ì„¸ì…˜1ê³¼ ì„¸ì…˜2ê°€ ë°ì´í„°ë¥¼ ë™ì‹œì— ìˆ˜ì •í•˜ëŠ” ë¬¸ì œë¥¼ ë½ìœ¼ë¡œ ì–´ë–»ê²Œ í•´ê²°í•˜ëŠ”ê°€](https://user-images.githubusercontent.com/42866800/166473541-1aec7a35-89dd-4ff2-99bb-e039b447078b.png)

- 2.

```sql
SET LOCK_TIMEOUT 60000;
set autocommit false;
update member set money=1000 where member_id = 'memberA';
```

- ì„¸ì…˜1ê³¼ ì„¸ì…˜2ê°€ ë™ì‹œì— ê°™ì€ rowì— ì ‘ê·¼í–ˆëŠ”ë° ì„¸ì…˜1ì´ ë” ë¹¨ë¼ì„œ ì„¸ì…˜1ì´ ë½ì„ íšë“í–ˆë‹¤

![ì„¸ì…˜1ì´ ë½ì„ íšë“í•œ ê²½ìš°](https://user-images.githubusercontent.com/42866800/166473586-e5562747-332b-4e6e-885d-df9dd85e5edf.png)
- 3.
- ì„¸ì…˜1ì´ update ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•œë‹¤
- ì„¸ì…˜2ë„ ë™ì‹œì— íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ì—¬ ë½ì„ íšë“í•˜ë ¤ê³  í•œë‹¤
- ê·¸ëŸ°ë° ë½ì´ ì„¸ì…˜1ì— ìˆê¸° ë•Œë¬¸ì— ë½ì„ íšë“í• ë•Œ ê¹Œì§€ ëŒ€ê¸°í•´ì•¼ í•œë‹¤

![ì„¸ì…˜1ì´ update ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤](https://user-images.githubusercontent.com/42866800/166473626-6920d50c-6128-4ac5-b3d2-b8445c339074.png)
- 4.

```sql
commit;
```

- ì„¸ì…˜1ì´ ì‘ì—…ì„ ëë‚´ê³  ì»¤ë°‹ì„ í•œë‹¤
- ë½ì´ ë°˜ë‚©ëœë‹¤

![ì„¸ì…˜1ì´ ì»¤ë°‹ì„ ìˆ˜í–‰í•˜ê³  ë½ì„ ë°˜ë‚©í•œë‹¤](https://user-images.githubusercontent.com/42866800/166473679-61ace3c2-d874-4e31-9aad-939ab3f64e8f.png)

- 5.

```sql
update member set money=1000 where member_id = 'memberA';
```

- ëŒ€ê¸°í•˜ê³  ìˆë˜ ì„¸ê²¬2ê°€ ë½ì„ íšë“í•œë‹¤
- ì„¸ì…˜2ê°€ ì§„í–‰í•˜ë ¤ê³  í–ˆë˜ update ì¿¼ë¦¬ê°€ ìˆ˜í–‰ëœë‹¤

![ë½ì„ íšë“í•˜ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ë˜ ì„¸ì…˜2ê°€ ë½ì„ íšë“í•œë‹¤](https://user-images.githubusercontent.com/42866800/166473740-7ef818d9-0ebf-46d9-bd86-36efc889a227.png)
- 6.

```sql
commit;
```

- ì„¸ì…˜2ê°€ ì‘ì—…ì„ ì™„ë£Œí•˜ì—¬ ì»¤ë°‹ì„ í•œë‹¤
- ë½ì´ ë°˜ë‚©ëœë‹¤


![ì„¸ì…˜2ê°€ update ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ê³  ì»¤ë°‹ í•œí›„ ë½ì„ ë°˜ë‚©í•œë‹¤](https://user-images.githubusercontent.com/42866800/166473888-88f2513c-d322-42a1-a7a1-90b3456ef549.png)

### ë½ íƒ€ì„ì•„ì›ƒ

- ì„¸ì…˜2ê°€ ë½ì„ íšë“í•˜ê¸° ìœ„í•´ ë½ íƒ€ì„ì•„ì›ƒ ì‹œê°„ì„ ì„¤ì •í•œë‹¤
- ì„¤ì •ëœ ì‹œê°„ì•ˆì— ë½ì„ íšë“í•˜ì§€ ëª»í•˜ê²Œ ë˜ë©´ ë½ íƒ€ì„ì•„ì›ƒ ì—ëŸ¬ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤

```sql
Timeout trying to lock table {0}; SQL statement:
update member set money=10000 - 2000 where member_id = 'memberA' [50200-200]
HYT00/50200
```

## DBë½ - ì¡°íšŒ

- ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œë„ ë½ì„ íšë“í•˜ê³  ì‹¶ì€ ê²½ìš°
- ì˜ˆ) ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì„œ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ëŠ” ì¤‘ìš”í•œ ì‘ì—…ì„ ì§„í–‰í•˜ê³  ìˆëŠ” ê²½ìš° ë‹¤ë¥¸ ì„¸ì…˜ì´ ì´ì „ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì„œ ìˆ˜ì •í•˜ëŠ” ê²½ìš° ë°ì´í„° ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ìƒí™©ì—ì„œ ì‚¬ìš©ê°€ëŠ¥
- `select for update` êµ¬ë¬¸ì„ ì‚¬ìš©í•œë‹¤
- ì„¸ì…˜1ì´ ì¡°íšŒ ì‹œì ì— ë½ì„ ê°€ì ¸ê°€ ë²„ë¦¬ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ í•´ë‹¹ ë°ì´í„°ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤

```sql
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
```

- ì„¸ì…˜1ì´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤
- ì¡°íšŒë¥¼ í•˜ë©°ë„ˆ ë™ì‹œì— ì„ íƒí•œ ë¡œìš°ì˜ ë½ì´ íšë“ëœë‹¤
- ì„¸ì…˜1ì€ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë  ë•Œê¹Œì§€ ì„ íƒí•œ ë¡œìš°ì— ëŒ€í•œ ë½ì„ ë³´ìœ í•œë‹¤

```sql
set autocommit false;
select * from member where member_id='memberA' for update;
```

- ì„¸ì…˜2ë„ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ê³  ì‹¶ì§€ë§Œ ì„¸ì…˜1ì´ ë½ì„ íšë“í–ˆê¸° ë–„ë¬¸ì— ì„¸ì…˜2ëŠ” ëŒ€ê¸°í•´ì•¼ í•œë‹¤
![ì„¸ì…˜2ë„ ë°ì´í„° ë³€ê²½ì„ ìœ„í•´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ì§€ë§Œ ë½ì´ ì—†ì–´ ëŒ€ê¸°í•´ì•¼ í•œë‹¤](https://user-images.githubusercontent.com/42866800/166473900-312930a6-7ce8-4948-a505-0f2c8e94ca43.png)

```sql
set autocommit false;
update member set money=500 where member_id = 'memberA';
```

- ì„¸ì…˜1ì´ ì‘ì—…ì„ ë§ˆë¬´ë¦¬í•˜ê³  ì»¤ë°‹í•œë‹¤
- ë½ì´ ë°˜ë‚©ëœë‹¤

```sql
commit;
```

- ì„¸ì…˜2ê°€ ë½ì„ íšë“í•˜ì—¬ update ì‘ì—… ì§„í–‰í›„ ì»¤ë°‹í•˜ë©´ ë½ì´ ë°˜ë‚©ëœë‹¤

```sql
commit;
```

## íŠ¸ëœì­ì…˜ ì˜ˆì œ1

- ë“œë¼ì´ë²„ë§¤ë‹ˆì €ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë””ë¹„ ì„œë²„ë¥¼ ì»¤ë„¥ì…˜ì„ ë§ºì–´ì¤€ë‹¤

```java
@BeforeEach
void before() {
    DriverManagerDataSource dataSource = new DriverManagerDataSource(URL, USERNAME , PASSWORD );
    memberRepository = new MemberRepositoryV1(dataSource);
    memberService = new MemberServiceV1(memberRepository);
}
```

- Member ê°ì²´ë¥¼ ìƒì„±í•œë‹¤
- fromId ì—ì„œ toId ë¡œ moneyë§Œí¼ ëˆì„ ì´ì²´í•œë‹¤
- fromIdì˜ ì”ì•¡ì€ money ë§Œí¼ ì°¨ê°ëœë‹¤
- toIdì˜ ì”ì•¡ì€ money ë§Œí¼ ì¦ê°€ëœë‹¤
- toIdì˜ idê°€ exì¸ ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤

```java
public void accountTransfer(String fromId, String toId, int money) throws SQLException {
    Member fromMember = memberRepositoryV1.findById(fromId);
    Member toMember = memberRepositoryV1.findById(toId);

    memberRepositoryV1.update(fromId, fromMember.getMoney() - money);
    validation(toMember);
    memberRepositoryV1.update(toId, toMember.getMoney() + money);
}
```

```java
private void validation(Member toMember) {
    if (toMember.getMemberId().equals("ex")) {
        throw new IllegalStateException("ì´ì²´ì¤‘ ì˜ˆì™¸ ë°œìƒ");
    }
}
```

- í…ŒìŠ¤íŠ¸ - ì •ìƒì ìœ¼ë¡œ ì´ì²´ê°€ ì™„ë£Œë˜ëŠ” ê²½ìš°
- MEMBER_A ê°ì²´ì™€ MEMBER_B ê°ì²´ë¥¼ ìƒì„±í•œë‹¤
- ê°ê° ê¸ˆì•¡ì€ ë§Œì›ì„ ê°–ê³  ìˆë‹¤
- ê° ê°ì²´ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•œë‹¤

- memberServiceì— ì„ ì–¸ëœ accountTransfer ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ MEMBER_Aê°€ MEMBER_Bë¡œ moneyë§Œí¼ì˜ ê¸ˆì•¡ì„ ì´ì²´í•œë‹¤
- MEMBER_Aì˜ ê²½ìš° moneyë§Œí¼ ì°¨ê°ëœ ê¸ˆì•¡ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì—…ë°ì´íŠ¸ ì‹œí‚¨ë‹¤
- ì´ì²´ë¥¼ ë°›ëŠ” Member ê°ì²´ì˜ ì´ë¦„ì´ exì¸ ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤
- MEMBER_Bì˜ ê²½ìš° money ë§Œí¼ ì¦ê°€ëœ ê¸ˆì•¡ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì—…ë°ì´íŠ¸ ì‹œí‚¨ë‹¤

- ì´ì²´ê°€ ì˜ë˜ì—ˆëŠ”ì§€ ê²€ì¦
- member ê°ì²´ì˜ memberIdê°’ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•´ ì˜¨ë‹¤
- memberAì˜ ì”ì•¡ì´ ì´ì²´í•œ money ê¸ˆì•¡ë§Œí¼ ì°¨ê°ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬
- memberBì˜ ì”ì•¡ì´ ì´ì²´ë°›ì€ money ê¸ˆì•¡ë§Œí¼ ì¦ê°€ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬

```java
@Test
@DisplayName("ì •ìƒ ì´ì²´")
void accountTransfer() throws SQLException {
    // given
    Member memberA = new Member(MEMBER_A, 10000);
    Member memberB = new Member(MEMBER_B, 10000);
    memberRepository.save(memberA);
    memberRepository.save(memberB);

    // when
    memberService.accountTransfer(memberA.getMemberId(), memberB.getMemberId(), 2000);

    // then
    Member findMemberA = memberRepository.findById(memberA.getMemberId());
    Member findMemberB = memberRepository.findById(memberB.getMemberId());

    assertThat(findMemberA.getMoney()).isEqualTo(8000);
    assertThat(findMemberB.getMoney()).isEqualTo(12000);
}
```

- í…ŒìŠ¤íŠ¸2 - ì´ì²´ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°
- MemberAê°€ MemberEXì—ê²Œ ì´ì²´í•˜ëŠ” ê²½ìš° ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤
- ì™œ?
- `accountTransfer` ë©”ì„œë“œì—ì„œ ì´ì²´ ë°›ëŠ” ì‚¬ëŒì˜ idë¥¼ ê²€ì¦í• ë•Œ idê°€ exì¸ ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ë„ë¡ ì„¤ê³„í–ˆê¸° ë•Œë¬¸ì´ë‹¤

```java
private void validation(Member toMember) {
    if (toMember.getMemberId().equals("ex")) {
        throw new IllegalStateException("ì´ì²´ì¤‘ ì˜ˆì™¸ ë°œìƒ");
    }
}
```

- ì˜ˆì™¸ê°€ ë°œìƒí•¨ìœ¼ë¡œì¨ MemberAì˜ ì”ì•¡ë§Œ moneyë§Œí¼ ì°¨ê°ëœë‹¤
- ì™œ?
- ì˜ˆì™¸ê°€ ë°œìƒí•˜ê¸° ì „ì— MemberAì˜ ì”ì•¡ì„ money ë§Œí¼ ì°¨ê°ì‹œí‚¨í›„ ë°ì´í„°ë² ì´ìŠ¤ì— update ì¿¼ë¦¬ë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ë•Œë¬¸ì´ë‹¤

```java
memberRepositoryV1.update(fromId, fromMember.getMoney() - money);
validation(toMember);
memberRepositoryV1.update(toId, toMember.getMoney() + money);
```

- MemberEXì˜ ê²½ìš° validation ë©”ì„œë“œì— ì˜í•´ idê°€ exì´ë¯€ë¡œ ì˜ˆì™¸ê°€ ë°œìƒëœë‹¤
- ì¦‰ , udpate ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ì˜ˆì™¸ê°€ ë¨¼ì € ë°œìƒë˜ë¯€ë¡œ MemberEXì˜ ì”ì•¡ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ë˜ê²Œ ëœë‹¤
- ë”°ë¼ì„œ ê²€ì¦í•  ë•Œ
- MemberAì˜ ì”ì•¡ì€ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ì–´ ê¸°ì¡´ MemberAê°€ ê°–ê³  ìˆë˜ ì”ì•¡ê³¼ ê°™ì€ì§€ ê²€ì¦
- MemberEXì˜ ì”ì•¡ì€ ê°’ì´ ê·¸ëŒ€ë¡œ ìœ ì§€ë˜ì—ˆëŠ”ì§€ ê²€ì¦í•œë‹¤

```java
@Test
@DisplayName("ì´ì²´ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí•¨")
void accountTransferEx() throws SQLException {
    // given
    Member memberA = new Member(MEMBER_A, 10000);
    Member memberEX = new Member(MEBMER_EX, 10000);
    memberRepository.save(memberA);
    memberRepository.save(memberEX);

    // when
    assertThatThrownBy(() -> memberService.accountTransfer(
            memberA.getMemberId(), memberEX.getMemberId(), 2000))
            .isInstanceOf(IllegalStateException.class);

    // then
    Member findMemberA = memberRepository.findById(memberA.getMemberId());
    Member findMemberB = memberRepository.findById(memberEX.getMemberId());
    assertThat(findMemberA.getMoney()).isEqualTo(10000);
    assertThat(findMemberB.getMoney()).isEqualTo(10000);
}
```


### íŠ¸ëœì­ì…˜ ì˜ˆì œ2

- íŠ¸ëœì­ì…˜ì„ ì–´ë””ì„œ ì‹œì‘í•˜ê³  ì–´ë””ì„œ ì»¤ë°‹í•˜ê±°ë‚˜ ë¡¤ë°±í•´ì•¼ í•˜ëŠ”ê°€
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì‹œì‘í•´ì•¼ í•œë‹¤
- ì™œ?
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì˜ëª»ë˜ì—ˆì„ë•Œ í•´ë‹¹ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìœ¼ë¡œ ì¸í•´ ì˜ëª»ë˜ëŠ” ë¶€ë¶„ë“¤ì´ í•¨ê»˜ ë¡¤ë°±ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤
- ì¦‰ ê³„ì¢Œì´ì²´ë¥¼ ë‹´ë‹¹í•˜ëŠ” accountTransfer ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ ë¬¸ì œê°€ ìƒê¸°ë©´ ë©”ì„œë“œ ìì²´ê°€ ë‹¤ í•¨ê»˜ ë¡¤ë°± ë˜ì–´ì•¼ í•œë‹¤
- ë”°ë¼ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‹¨ìœ„ë¡œ íŠ¸ëœì­ì…˜ì„ ê±¸ì–´ì•¼ í•œë‹¤
- `íŠ¸ëœì­ì…˜ì„ ê±´ë‹¤` - íŠ¸ëœì­ì…˜ì„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‹¨ìœ„ë¡œ ì‹œì‘ í•˜ê³  íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë ë•Œ ì»¤ë°‹í•˜ê±°ë‚˜ ë¡¤ë°±í•œë‹¤

- íŠ¸ëœì­ì…˜ì„ ì‹œì‘ í•˜ë ¤ë©´ ì»¤ë„¥ì…˜ì´ í•„ìš”í•˜ë‹¤

```java
set autocommit false;
```

 

- ì™œ?
- ì»¤ë„¥ì…˜ì´ ìˆì–´ì•¼ ë””ë¹„ ì„œë²„í•œí…Œ ëª…ë ¹ì„ ë‚ ë¦¬ê³  ë””ë¹„ ì„œë²„ê°€ ëª…ë ¹ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤
- ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ DB íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë™ì•ˆ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•´ì•¼ í•œë‹¤
- ì™œ?
- íŠ¸ëœì­ì…˜ì´ ê±¸ë ¤ìˆëŠ” ë™ì•ˆ ê°™ì€ DB ì„œë²„ì— ì ‘ê·¼í• ë•Œ ê°™ì€ ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì ‘ê·¼í•˜ê¸° ìœ„í•¨ì´ë‹¤
- ë”°ë¼ì„œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ë ¤ë©´ ì»¤ë„¥ì…˜ì´ í•„ìš”í•˜ë‹¤
- ì»¤ë„¥ì…˜ì´ ê°™ì•„ì•¼ ê°™ì€ ì„¸ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤

<aside>
ğŸ“Œ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë™ì•ˆ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•´ì•¼ í•œë‹¤

</aside>

- ì™œ?
- ë‹¤ë¥¸ ì»¤ë„¥ì…˜ì—ì„œ ë™ì‘í•˜ë©´ íŠ¸ëœì­ì…˜ë„ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì´ë‹¤
- í•˜ë‚˜ì˜ ì„¸ì…˜ì—ì„œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë  ë•Œ ì»¤ë°‹ ë˜ëŠ” ë¡¤ë°±ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” ì»¤ë„¥ì…˜ì´ ê³„ì† ìœ ì§€ë˜ì–´ì•¼ í•œë‹¤

- ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•˜ëŠ” ë°©ë²•
- ì»¤ë„¥ì…˜ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ì„œ ê°™ì€ ì»¤ë„¥ì…˜ì´ ì‚¬ìš©ë˜ë„ë¡ ìœ ì§€í•´ì•¼ í•œë‹¤

1. ë¦¬í¬ì§€í„°ë¦¬ê°€ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•˜ë„ë¡ íŒŒë¼ë¯¸í„°ë¡œ ì»¤ë„¥ì…˜ì„ ì „ë‹¬í•œë‹¤
- ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œëŠ” ì»¤ë„¥ì…˜ì„ close í•´ì£¼ë©´ ì•ˆëœë‹¤
- ì™œ?
- ì»¤ë„¥ì…˜ì„ ë‹«ëŠ” ê²°ì •ì€ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ëœ ê³³ì—ì„œ ë‹«ì•„ì¤˜ì•¼ í•œë‹¤
- ì¦‰ , ì„œë¹„ìŠ¤ì—ì„œ ì»¤ë„¥ì…˜ì„ ë‹«ì•„ì¤˜ì•¼ í•œë‹¤

```java
public Member findById(Connection con, String memberId) throws SQLException {
        String sql = "select * from member where member_id = ?";

        PreparedStatement pstmt = null;
        ResultSet rs = null;

        try {
            pstmt = con.prepareStatement(sql);
            pstmt.setString(1, memberId);

            rs = pstmt.executeQuery();
            if (rs.next()) {
                Member member = new Member();
                member.setMemberId(rs.getString("member_id"));
                member.setMoney(rs.getInt("money"));
                return member;
            } else {
                throw new NoSuchElementException("member not found memberId=" + memberId);
            }

        } catch (SQLException e) {
            log.error("db error", e);
            throw e;
        } finally {
            //connectionì€ ì—¬ê¸°ì„œ ë‹«ì§€ ì•ŠëŠ”ë‹¤.
            JdbcUtils.closeResultSet(rs);
            JdbcUtils.closeStatement(pstmt);
        }

    }
```

```java
public void update(Connection con, String memberId, int money) throws SQLException {
    String sql = "update member set money=? where member_id=?";

    PreparedStatement pstmt = null;

    try {
        pstmt = con.prepareStatement(sql);
        pstmt.setInt(1, money);
        pstmt.setString(2, memberId);
        int resultSize = pstmt.executeUpdate();
        log.info("resultSize={}", resultSize);
    } catch (SQLException e) {
        log.error("db error", e);
        throw e;
    } finally {
        //connectionì€ ì—¬ê¸°ì„œ ë‹«ì§€ ì•ŠëŠ”ë‹¤.
        JdbcUtils.closeStatement(pstmt);
    }

}
```

1. íŠ¸ëœì­ì…˜ ì—°ë™ ë¡œì§
- ì„œë¹„ìŠ¤ì—ì„œ ì»¤ë„¥ì…˜ì„ ì–»ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— DataSourceê°€ í•„ìš”í•˜ë‹¤
- dataSourceë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¤ë„¥ì…˜ì„ ì–»ì–´ì–¸ë„
- set autocommit ì„ falseë¡œ ì„¤ì •í•˜ì—¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘ì‹œí‚¨ë‹¤
    - ì™œ?
    - íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ë ¤ë©´ ìë™ ì»¤ë°‹ ëª¨ë“œê°€ êº¼ì ¸ì•¼ í•œë‹¤
    - ìë™ì»¤ë°‹ ëª¨ë“œë¥¼ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¡œ ë³€ê²½í•˜ëŠ” ê²ƒì„ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤ê³  í•œë‹¤
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ê³  ë‚œí›„ ì»¤ë°‹ì„ í•´ì¤˜ì•¼ í•œë‹¤
- ì»¤ë„¥ì…˜ì„ í†µí•´ DBì„œë²„ë¡œ ì»¤ë°‹ëª…ë ¹ì´ ì „ë‹¬ë˜ê³  ì„¸ì…˜ì´ ì»¤ë°‹ì„ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤
- ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° ì»¤ë„¥ì…˜ì„ í†µí•´ ë¡¤ë°±ì„ í•´ì¤˜ì•¼ í•œë‹¤
- íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ë©´ ìì›ì„ í•´ì œí•´ ì¤€ë‹¤
    
    ```java
    private void release(Connection con) {
        if (con != null) {
            try {
                con.setAutoCommit(true); //ì»¤ë„¥ì…˜ í’€ ê³ ë ¤
                con.close();
            } catch (Exception e) {
                log.info("error", e);
            }
        }
    }
    ```
    
    - ì»¤ë„¥ì…˜ì„ í•´ì œí•˜ë©´ ì»¤ë„¥ì…˜ í’€ë¡œ ë°˜í™˜ëœë‹¤
    - ê·¸ëŸ°ë° set autocommitì´ falseì¸ ìƒíƒœë¡œ ì»¤ë„¥ì…˜ì´ ë°˜í™˜ëœë‹¤
    - ê·¸ëŸ¬ë©´ ìˆ˜ë™ì„ ì»¤ë°‹ì„ í•´ì¤˜ì•¼ í•œë‹¤
    - ê¸°ë³¸ defaultê°€ trueì´ë¯€ë¡œ ì»¤ë„¥ì…˜ì˜ autocommitì„ trueë¡œ ë°”ê¿”ì£¼ê³  ì»¤ë„¥ì…˜ í’€ë¡œ ë°˜í™˜í•´ ì¤˜ì•¼ í•œë‹¤
    - ê·¸ë˜ì•¼ ì»¤ë„¥ì…˜ í’€ì—ì„œ autocommitì´ trueì¸ ìƒíƒœê°€ ìœ ì§€ëœë‹¤

- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” bizLogic ë©”ì„œë“œë¡œ ì»¤ë„¥ì…˜ì„ ì „ë‹¬í•˜ë©´ì„œ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ëœë‹¤
- ì¦‰ , bizLogic ë©”ì„œë“œ ë‚´ë¶€ ë¡œì§ì´ ìˆ˜í–‰ë˜ëŠ” ë™ì•ˆ ë™ì¼í•œ íŠ¸ëœì­ì…˜ì—ì„œ ë™ì¼í•œ ì»¤ë„¥ì…˜ì´ ìœ ì§€ë˜ê²Œ ëœë‹¤

```java
public void accountTransfer(String fromId, String toId, int money) throws SQLException {
    Connection con = dataSource.getConnection();

    try {
        // íŠ¸ëœì­ì…˜ ì‹œì‘
        con.setAutoCommit(false);
        // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
        bizLogic(con, fromId, toId, money);
        con.commit(); // ì„±ê³µì‹œ ì»¤ë°‹
    } catch (Exception e) {
        con.rollback(); // ì‹¤íŒ¨ì‹œ ë¡¤ë°±
        throw new IllegalStateException(e);
    } finally {
        release(con);
    }
}
```

- íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•˜ëŠ” ë¡œì§ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë”°ë¡œ bizLogic ë©”ì„œë“œë¡œ ë¶„ë¦¬í–ˆë‹¤
- ë¦¬í¬ì§€í„°ë¦¬ì—ì„œë„ ë™ì¼í•˜ê²Œ ì»¤ë„¥ì…˜ì´ ìœ ì§€ë˜ì–´ì•¼ í•œë‹¤
- ë”°ë¼ì„œ ë¦¬í¬ì§€í„°ë¦¬ì— ì„ ì–´ëœ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œë©©ë„ ì»¤ë„¥ì…˜ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ì•¼ í•œë‹¤

```java
private void bizLogic(Connection con, String fromId, String toId, int money) throws SQLException {
    Member fromMember = memberRepository.findById(con, fromId);

    Member toMember = memberRepository.findById(con, toId);

    memberRepository.update(con, fromId, fromMember.getMoney() - money);
    validation(toMember);
    memberRepository.update(con, toId, toMember.getMoney() + money);
}
```

- finally ì—ì„œ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ë©´ ì»¤ë„¥ì…˜ì„ í•´ì œí•´ ì¤˜ì•¼ í•œë‹¤
- ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¥¼ ìë™ ì»¤ë°‹ ëª¨ë“œë¡œ ë³€ê²½ìš° ì»¤ë„¥ì…˜ì„ ì¢…ë£Œí•´ ì¤˜ì•¼ í•œë‹¤

```java
private void release(Connection con) {
    if (con != null) {
        try {
            con.setAutoCommit(true); //ì»¤ë„¥ì…˜ í’€ ê³ ë ¤
            con.close();
        } catch (Exception e) {
            log.info("error", e);
        }
    }
}
```

- ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì»¤ë„¥ì…˜ì„ í•´ì œí•˜ë©´ autocommit ëª¨ë“œê°€ ìë™ ì»¤ë°‹ëª¨ë“œë¡œ ìë™ìœ¼ë¡œ ëŒì•„ê°„ë‹¤
- í•˜ì§€ë§Œ ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° autocommit ëª¨ë“œë¥¼ ìë™ ì»¤ë°‹ ëª¨ë“œë¡œ ì„¤ì •í•´ ì¤€í›„ ì»¤ë„¥ì…˜ í’€ì— ë°˜ë‚©í•´ ì¤˜ì•¼ í•œë‹¤
- ì™œ?
- ì»¤ë„¥ì…˜ í’€ì—ì„œë„ ì„¸ì…˜ì´ ê³„ì† ìœ ì§€ë˜ì–´ ì»¤ë„¥ì…˜ì´ ì‚´ì•„ìˆê¸° ë•Œë¬¸ì— ë°˜ë‚©ëœ ì»¤ë„¥ì…˜ì„ íšë“í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ëŠ” ìˆ˜ë™ìœ¼ë¡œ ì»¤ë°‹ì„ í•´ì¤˜ì•¼ í•˜ëŠ” ë¬¸ì œê°€ ìƒê¸¸ìˆ˜ ìˆë‹¤

### íŠ¸ëœì­ì…˜ ì˜ˆì œ2 - í…ŒìŠ¤íŠ¸

```java
@Test
@DisplayName("ì •ìƒ ì´ì²´")
void accountTransfer() throws SQLException {
    // given
    Member memberA = new Member(MEMBER_A, 10000);
    Member memberB = new Member(MEMBER_B, 10000);
    memberRepository.save(memberA);
    memberRepository.save(memberB);

    // when
    log.info("START TX");
    memberService.accountTransfer(memberA.getMemberId(), memberB.getMemberId(), 2000);
    log.info("END TX");

    // then
    Member findMemberA = memberRepository.findById(memberA.getMemberId());
    Member findMemberB = memberRepository.findById(memberB.getMemberId());

    assertThat(findMemberA.getMoney()).isEqualTo(8000);
    assertThat(findMemberB.getMoney()).isEqualTo(12000);
}
```

- ì™œ ì´ëŸ° ë¡œê·¸ê°€ ë‚˜ì˜¤ëŠ”ê°€
- memberServiceì˜ accountTransfer ë©”ì„œë“œ ë‚´ë¶€ì—ì„œëŠ” ê°™ì€ íŠ¸ëœì­ì…˜ì´ ì‚¬ìš©ëœë‹¤
- ê³„ì¢Œì´ì²´ê°€ ì™„ë£Œëœí›„
- ê²€ì¦í•˜ê¸° ìœ„í•´ memberRepositoryë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì¡°íšŒí•´ ì˜¤ëŠ” ê²½ìš° ë‹¤ë¥¸ ì»¤ë„¥ì…˜ì´ ì‚¬ìš©ëœë‹¤
- í˜„ì¬ ê²€ì¦ì„ ìœ„í•´ memberRepositoryì—ì„œ findById ë©”ì„œë“œë¥¼ ë‘ë²ˆ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— ì´ë•ŒëŠ” ë‹¤ë¥¸ ì»¤ë„¥ì…˜ì´ ì‚¬ìš©ë˜ì–´ ë¡œê·¸ê°€ ë‚¨ê²¨ì§€ê²Œ ëœë‹¤

```java
21:39:21.363 [main] INFO hello.jdbc.service.MemberServiceV2Test - START TX
21:39:21.363 [main] DEBUG org.springframework.jdbc.datasource.DriverManagerDataSource - Creating new JDBC DriverManager Connection to [jdbc:h2:tcp://localhost/~/test]
21:39:21.376 [main] INFO hello.jdbc.repository.MemberRepositoryV2 - resultSize=1
21:39:21.377 [main] INFO hello.jdbc.repository.MemberRepositoryV2 - resultSize=1
21:39:21.379 [main] INFO hello.jdbc.service.MemberServiceV2Test - END TX
21:39:21.380 [main] DEBUG org.springframework.jdbc.datasource.DriverManagerDataSource - Creating new JDBC DriverManager Connection to [jdbc:h2:tcp://localhost/~/test]
21:39:21.382 [main] INFO hello.jdbc.repository.MemberRepositoryV2 - get connection=conn3: url=jdbc:h2:tcp://localhost/~/test user=SA, class=class org.h2.jdbc.JdbcConnection
21:39:21.385 [main] DEBUG org.springframework.jdbc.datasource.DriverManagerDataSource - Creating new JDBC DriverManager Connection to [jdbc:h2:tcp://localhost/~/test]
21:39:21.388 [main] INFO hello.jdbc.repository.MemberRepositoryV2 - get connection=conn4: url=jdbc:h2:tcp://localhost/~/test user=SA, class=class org.h2.jdbc.JdbcConnection
21:39:21.476 [main] DEBUG org.springframework.jdbc.datasource.DriverManagerDataSource - Creating new JDBC DriverManager Connection to [jdbc:h2:tcp://localhost/~/test]
21:39:21.479 [main] INFO hello.jdbc.repository.MemberRepositoryV2 - get connection=conn5: url=jdbc:h2:tcp://localhost/~/test user=SA, class=class org.h2.jdbc.JdbcConnection
21:39:21.480 [main] DEBUG org.springframework.jdbc.datasource.DriverManagerDataSource - Creating new JDBC DriverManager Connection to [jdbc:h2:tcp://localhost/~/test]
21:39:21.483 [main] INFO hello.jdbc.repository.MemberRepositoryV2 - get connection=conn6: url=jdbc:h2:tcp://localhost/~/test user=SA, class=class org.h2.jdbc.JdbcConnection
21:39:21.485 [main] DEBUG org.springframework.jdbc.datasource.DriverManagerDataSource - Creating new JDBC DriverManager Connection to [jdbc:h2:tcp://localhost/~/test]
21:39:21.487 [main] INFO hello.jdbc.repository.MemberRepositoryV2 - get connection=conn7: url=jdbc:h2:tcp://localhost/~/test user=SA, class=class org.h2.jdbc.JdbcConnection
```

- ì´ì²´ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ì½”ë“œ í…ŒìŠ¤íŠ¸
- íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ê³  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ì˜ˆì™¸ê°€ í„°ì§„ë‹¤
- ì˜ˆì™¸ê°€ í„°ì§€ë©´ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°± ì‹œí‚¨ë‹¤
- ê·¸ëŸ°ë©´ ë°ì´í„°ê°€ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ê¸° ì „ìœ¼ë¡œ ì›ë³µëœë‹¤
- ë”°ë¼ì„œ ë°ì´í„°ë¥¼ ê²€ì¦í•  ë•Œ ì›ë³µëœ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë¹„êµí•´ì•¼ ì˜¬ë°”ë¥¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì•ˆì—ì„œëŠ” í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì—¬ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²½ìš° ë°ì´í„°ê°€ ë¡¤ë°±ëœë‹¤

```java
@Test
@DisplayName("ì´ì²´ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí•¨")
void accountTransferEx() throws SQLException {
    // given
    Member memberA = new Member(MEMBER_A, 10000);
    Member memberEX = new Member(MEMBER_EX, 10000);
    memberRepository.save(memberA);
    memberRepository.save(memberEX);

    // when
    assertThatThrownBy(() -> memberService.accountTransfer(
            memberA.getMemberId(), memberEX.getMemberId(), 2000))
            .isInstanceOf(IllegalStateException.class);

    // then

    Member findMemberA = memberRepository.findById(memberA.getMemberId());
    Member findMemberB = memberRepository.findById(memberEX.getMemberId());
    assertThat(findMemberA.getMoney()).isEqualTo(10000);// íŠ¸ëœì­ì…˜ì„ ë¡¤ë°± í–ˆê¸° ë–„ë¬¸ì— memberAì˜ ê¸ˆì•¡ë„ íŠ¸ëœì­ì…˜ ì‹œì‘ì „ìœ¼ë¡œ ë¡¤ë°± ë˜ì–´ì•¼ í•œë‹¤
    assertThat(findMemberB.getMoney()).isEqualTo(10000);
}
```

```java
public void accountTransfer(String fromId, String toId, int money) throws SQLException {
        Connection con = dataSource.getConnection();

        try {
            // íŠ¸ëœì­ì…˜ ì‹œì‘
            con.setAutoCommit(false);
            // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
            bizLogic(con, fromId, toId, money);
            con.commit(); // ì„±ê³µì‹œ ì»¤ë°‹
        } catch (Exception e) {
            con.rollback(); // ì‹¤íŒ¨ì‹œ ë¡¤ë°±
            throw new IllegalStateException(e);
        } finally {
            release(con);
        }
    }
```

- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì—¬ ìˆë‹¤
- ë”°ë¼ì„œ toMemberë¥¼ ê²€ì¦í•˜ëŠ” ê³¼ì •ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°
- fromIdê°€ ê°–ê³  ìˆë˜ moneyë„ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ê¸° ì „ìœ¼ë¡œ ë°ì´í„°ê°€ ì›ë³µë˜ê³ 
- toIdê°€ ê°–ê³  ìˆë˜ moneyë„ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ê¸° ì „ìœ¼ë¡œ ë°ì´í„°ê°€ ì›ë³µëœë‹¤

```java
private void bizLogic(Connection con, String fromId, String toId, int money) throws SQLException {
  Member fromMember = memberRepository.findById(con, fromId);

  Member toMember = memberRepository.findById(con, toId);

  memberRepository.update(con, fromId, fromMember.getMoney() - money);
  validation(toMember);
  memberRepository.update(con, toId, toMember.getMoney() + money);
}
```

- ë”°ë¼ì„œ memberAì˜ ê¸ˆì•¡ì„ ê²€ì¦í• ë•Œ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ê¸° ì´ì „ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê²€ì¦í•´ì•¼ í•œë‹¤

```java
// then
Member findMemberA = memberRepository.findById(memberA.getMemberId());
Member findMemberB = memberRepository.findById(memberEX.getMemberId());
assertThat(findMemberA.getMoney()).isEqualTo(10000);// íŠ¸ëœì­ì…˜ì„ ë¡¤ë°± í–ˆê¸° ë–„ë¬¸ì— memberAì˜ ê¸ˆì•¡ë„ íŠ¸ëœì­ì…˜ ì‹œì‘ì „ìœ¼ë¡œ ë¡¤ë°± ë˜ì–´ì•¼ í•œë‹¤
assertThat(findMemberB.getMoney()).isEqualTo(10000);

```

- ì—ëŸ¬ê°€ ë°œìƒí–ˆë˜ ì›ì¸
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ë¦¬í¼ì§€í„°ë¦¬ì— udpateë¥¼ ìš”ì²­í• ë•Œ ì»¤ë„¥ì…˜ì„ ì „ë‹¬í•˜ì§€ ì•Šì•˜ë‹¤
- ë”°ë¼ì„œ updateê°€ ì‹¤í–‰ë ë•Œ ë‹¤ë¥¸ ì»¤ë„¥ì…˜ì—ì„œ ì‹¤í–‰ëœë‹¤
- ë‹¤ë¥¸ ì»¤ë„¥ì…˜ì—ì„œ ì‹¤í–‰ë˜ë©´ íŠ¸ëœì­ì…˜ë„ ë‹¬ë¼ì§„ë‹¤
- ë”°ë¼ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒë˜ì–´ ë¡¤ë°±ì„ í•˜ëŠ” ê²½ìš° udpate ì¿¼ë¦¬ê°€ ë¡¤ë°±ë˜ì§€ ì•Šì•„ í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í–ˆì—ˆë‹¤

```java
private void bizLogic(Connection con, String fromId, String toId, int money) throws SQLException {
  ...
  ...
  memberRepository.update(con, fromId, fromMember.getMoney() - money);
  validation(toMember);
  memberRepository.update(con, toId, toMember.getMoney() + money);
}
```

- ë¬¸ì œì 
- ì„œë¹„ìŠ¤ ê³„ì¸µì— íŠ¸ëœì­ì…˜ì„ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì„ì—¬ìˆë‹¤
- ë˜í•œ ì»¤ë„¥ì…˜ì„ ìœ ì§€ì‹œí‚¤ê¸° ìœ„í•´ í•­ìƒ ì»¤ë„¥ì…˜ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ ì¤˜ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆë‹¤

<aside>
ğŸ“Œ íŒ!! ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ ë ˆì´ì–´ê°€ ë‹¤ë¥¸ ê²½ìš° ë¶„ë¦¬í•´ì•¼ ê°€ë…ì„±ì´ ë†’ì•„ì§„ë‹¤

</aside>

### ì •ë¦¬

- íŠ¸ëœì­ì…˜ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ì‹œì‘ë˜ê³  ì¢…ë£Œë˜ì–´ì•¼ í•œë‹¤
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ê´€ë¦¬í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ë•Œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì „ì²´ë¥¼ ë¡¤ë°±ì‹œí‚¬ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤
- íŠ¸ëœì­ì…˜ë‚´ì—ì„œ ë””ë¹„ ì„œë²„ì— ì™”ë‹¤ê°”ë‹¤ í• ë•Œ ì»¤ë„¥ì…˜ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•˜ì—¬ ë™ì¼í•œ ì»¤ë„¥ì…˜ì„ í†µí•´ DB ì‘ì—…ì´ ì´ë£¨ì–´ì§€ê²Œ í•œë‹¤
- autocommit ëª¨ë“œë¥¼ falseë¡œ ì„¤ì •í•˜ì—¬ íŠ¸ëœì­ì…˜ì„ ì‹œì‘ì‹œí‚¨ë‹¤
- ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì»¤ë„¥ì…˜ì„ í•´ì œí•  ë•Œ autocommit ëª¨ë“œë¥¼ trueë¡œ ì„¤ì •í•œ í›„ ì»¤ë„¥ì…˜ í’€ë¡œ ë°˜í™˜í•´ ì¤€ë‹¤

ì°¸ê³  - 

[https://mangkyu.tistory.com/154](https://mangkyu.tistory.com/154)

[https://victorydntmd.tistory.com/129](https://victorydntmd.tistory.com/129)

[https://hanamon.kr/ë°ì´í„°ë² ì´ìŠ¤-íŠ¸ëœì­ì…˜ì˜-acid-ì„±ì§ˆ/](https://hanamon.kr/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-acid-%EC%84%B1%EC%A7%88/)

[https://covenant.tistory.com/85](https://covenant.tistory.com/85)

[https://jordy-torvalds.tistory.com/121](https://jordy-torvalds.tistory.com/121)















ì°¸ê³  - 

[https://mangkyu.tistory.com/154](https://mangkyu.tistory.com/154)

[https://victorydntmd.tistory.com/129](https://victorydntmd.tistory.com/129)

[https://hanamon.kr/ë°ì´í„°ë² ì´ìŠ¤-íŠ¸ëœì­ì…˜ì˜-acid-ì„±ì§ˆ/](https://hanamon.kr/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98%EC%9D%98-acid-%EC%84%B1%EC%A7%88/)

[https://covenant.tistory.com/85](https://covenant.tistory.com/85)

[https://jordy-torvalds.tistory.com/121](https://jordy-torvalds.tistory.com/121)