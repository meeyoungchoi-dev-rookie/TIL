/**
    원래있던 코드 : 금액관련 오류 있을때 메일 내용을 쌓는다
    => 보내지는 않는다

    거래일자가 오늘날짜와 같은지 판단 하여 같지 않을때 메일을 보낸다
 
    + 금액 오류만 o => 메일 안보냄
    + 거래일자가 오늘 날짜와 같지 않을때 o , 금액 오류 x => 메일 보냄
    + 거래일자가 오늘 날짜와 같지 않을때 o , 금액 오류 o => 거래일자가 오늘 날짜와 같지 않을때에 대해서만 메일을 보내야 한다
*/

if (금액관련 오류 있을때) {
    메일 내용 쌓음
}

// 메서드 내부에서 처리하면

// 오늘 날짜

// 거래 일짜
```
if (거래일짜가 오늘날짜가 아닐경우 && 금액 관련 오류 없을때) {
    메일 보냄
}
```
```
/*
          과거일자   금액 오류
          true     true => 보내면 안됨
          false     true => 보내면 안됨
          false      false => 보내면 안됨
          true       false => 보내야 됨 =>  얘는 위에 조건문에서 걸러진다
*/
if (거래일짜가 오늘날짜가 아닐경우 || 금액 관련 오류 있을때) {
    1.과거일자에 대해서 로그를 남긴다
    2. 금액 관련 오류 로그를 남긴다
}
```

```

    && : 양쪽다 true 여야 참
    || : 한쪽 이라도 true이면 참
```


1. 과거일자 인지 판단하는 것을 미리 처리해서 받는다
2. 기존 코드는 그대로 둔다
3. 메일 쌓는 메서드에 과거일자 판단 결과를 전달


### 승인
1. tb_vandb_msg 테이블에서 van에 저장된 거래내역 조회
2. tb_card_van_msg 테이블에서 van이랑 제휴맺은 신용카드 거래내역 조회
3. 없으면 tb_card_van_msg 테이블에 insert 한다
4. 승인 성공을 판단하기 위한 유효성 검사 진행
5. 가맹점 번호를 사용하여 영중소 정보조회
6. msg_cd가 0000 이면 성공
7. tb_trans , tb_trans_history , tb_card_trans 테이블에 승인 성공 원장 저장
8. msg_cd가 9999 이면 실패
9. tb_fail_trans , tb_card_fail 테이블에 승인 실패 원장 저장

### 전체 취소
1. tb_card_van_msg , tb_trans_history join 해서 van에 저장된 원승인 거래 조회
2. tb_pard_cancel_history 테이블에서 부분취소 이력이 있는지 조회
- 부분취소 이력이 있으면 전체 취소 불가
3. tb_trans 테이블의 state_cd 컬럼을 1로 update
4. tb_card_trans 테이블에서 취소 상태 변경
5. tb_trans_history , tb_cancel_history 테이블에 취소 원장 저장

### 거래대사
+ 거래내역 전문이 담겨있는 파일
+ 파일을 한줄씩 읽으면서
+ van 거래대사에 있는 거래내역이 pg에 있는지 검사한다

### 거래대사 승인
+ state_cd가 CA
+ tb_card_van_msg 테이블에서 거래에 대한 취소내역이 존재하는지 조회
+ 취소 내역이 있는 경우 -> tb_card_van_msg 테이블과 tb_trans_history 테이블을 조인해서 tid 를 사용해서 원승인 거래를 조회한다
+ 원승인 거래가 있으면 tb_card_van_msg 테이블에 원승인 거래 내역을 저장한다
+ 원승인 거래가 없다 -> ???
+ tb_card_trans 테이블에서 해당 거래를 한 카드로 취소내역이 있는지 조회한다
+ 취소 내역이 있는 경우 tb_trans_history 테이블에서 신용카드 취소 상태를 조회핸다
+ tb_trans , tb_card_trans , tb_trans_history 테이블의 취소상태를 변경한다

### 거래대사 전체취소
+ state_cd가 CP
+ tb_card_van_msg 테이블에서 거래에 대한 취소내역이 존재하는지 조회
+ 취소 내역이 있는 경우 -> tb_card_van_msg 테이블과 tb_trans_history 테이블을 조인해서 tid 를 사용해서 원승인 거래를 조회한다
+ 원승인 거래가 있으면 tb_card_van_msg 테이블에 원승인 거래 내역을 저장한다
+ tb_card_trans 테이블에서 원승인 거래에 대한 취소내역이 있는지 조회한다
+ tb_part_cancel_history 테이블에서 원승인 거래에 대한 부분취소 횟수를 조회한다
+ 부분취소 횟수가 0이면 최초 부분취소이다

#### 채워야 하는 부분
+ 원승인 거래가 없을때 어떻게 되는지
+ 원승인 거래에 대한 취소내역이 없을때 어떻게 되는지
+ 원승인 거래에 대한 부분취소 횟수가 존재하는 경우 (최초 부분취소가 아닐때) 어떻게 되는지

### 공통
+ while문에서 거래대사 파일을 한줄씩 읽는다
+ tb_vandb_mig_info 테이블에서 vandv에 오늘 날짜로 단말기로 거래된 내역이 있는지 조홰
+ 파일작성일자 , 터미널번호 길이 검사
+ state_cd 값에 따른 분기처리
+ CA : 승인 , CP : 전체취소 , CC : 부분취소
+ 각 상태에 따라 , 거래 건수 , 거래 성공 건수 , 거래 진행중 에러 발생 건수를 담는다
+ BufferedReader 종료
+ 트랜잭션 커밋
+ 메일전송 , sms 전송
+ 경고 메일 전송 , 경고 sms 전송


### DB관련
+ tb_join_info 테이블과 tb_cpid 테이블을 조인하여 간편결제 등록 정보 조회
+ tb_part_mer_svc : 하위서비스별 등록된 간편결제 서비스 조회




